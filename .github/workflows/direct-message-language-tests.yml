# Direct Message Language Tests - Uses Docker container for consistent environment
# Migrated from Tryorama (TypeScript) to sweettest (Rust) for stability

name: Direct Message Language

on:
  push:
    branches:
      - main
      - staging
      - bootstrap-languages

jobs:
  sweettest:
    name: Sweettest
    runs-on: ubuntu-latest
    container:
      image: coasys/ad4m-ci-linux:latest@sha256:3d6e8b6357224d689345eebd5f9da49ee5fd494b3fd976273d0cf5528f6903ab

    steps:
    - uses: actions/checkout@v3

    # Rust toolchain configured via rust-toolchain.toml
    - name: Verify Rust toolchain
      run: rustc --version && cargo --version && hc --version

    - name: Install dependencies
      run: pnpm install --no-frozen-lockfile

    - name: Build zomes
      run: |
        cd bootstrap-languages/direct-message-language/hc-dna
        cargo build --release --target wasm32-unknown-unknown

    - name: Build DNA
      run: |
        cd bootstrap-languages/direct-message-language/hc-dna
        hc dna pack workdir

    - name: Run sweettest
      run: |
        cd bootstrap-languages/direct-message-language/hc-dna/tests/sweettest
        cargo test --release -- --nocapture
