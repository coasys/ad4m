import { Callout } from "nextra-theme-docs";

# Perspectives: Agent-Centric Knowledge Graphs

## Understanding Perspectives

Perspectives are semantic knowledge graphs inspired by the Semantic Web and Linked Data principles, but reimagined through an agent-centric lens. While traditional RDF graphs and Solid PODs are designed around data ownership, Perspectives emphasize that all knowledge is inherently subjective and tied to the agent who claims it.

### Objective vs. Subjective Data

In AD4M, we distinguish between two types of data:

1. **Objective Data** (Expressions):
   - Stored in Languages
   - Same content for any agent requesting a given URL
   - Cryptographically signed by their author
   - Example: A post stored at `QmSocial123://post789`

2. **Subjective Data** (Perspectives):
   - Personal associations between Expressions
   - Owned by a specific agent
   - Represent that agent's view of relationships
   - Example: Agent Alice linking a post as "important" or "related-to" another post

### Links: Agent-Centric Triples

Perspectives consist of Links – our agent-centric version of RDF triples. Each Link connects three URIs:
```typescript
interface Link {
    source: string;      // Subject Expression URL
    predicate: string;   // Predicate Expression URL
    target: string;      // Object Expression URL
}
```

These Links are stored as LinkExpressions – special Expressions where the `data` field contains a Link:
```typescript
{
    author: "did:key:z6Mk...",  // Who made this association
    timestamp: "2023-06-21...",
    data: {
        source: "QmSocial123://post789",
        predicate: "sioc://likes",
        target: "did:key:z6Mk..."
    },
    proof: { ... }  // Cryptographic proof of the claim
}
```

### Subjective Overlays

Perspectives act as subjective overlays on the objective Expression layer:
- Every node in the graph must be a URI pointing to an Expression
- The same Expressions can appear in many Perspectives with different relationships
- Each agent can maintain multiple Perspectives for different contexts
- Links in a Perspective represent an agent's claims about relationships

For example:
```
Agent Alice's Perspective:
Post1 --likes--> Post2
Post2 --related-to--> Post3

Agent Bob's Perspective:
Post1 --disagrees-with--> Post2
Post2 --authored-by--> Carol
```

## Storage and Sharing

Perspectives are stored locally in your AD4M instance's database, but can be shared in several ways:

1. **Snapshots**: 
   - Export a Perspective as an Expression
   - Contains a JSON rendering of all Links
   - Useful for point-in-time sharing

2. **Neighbourhoods**:
   - Collaborative spaces where multiple agents share and sync Perspectives
   - Real-time updates and p2p synchronization
   - See [Neighbourhoods](/neighbourhoods) for more details

### Future Standards Integration

While AD4M currently uses its own formats to accommodate agent-centric features, we plan to implement W3C, RDF, and Solid compatibility:
- Every Perspective will be accessible as a Solid POD
- Links will be expressible as RDF triples
- Standard SPARQL queries will be supported

## Working with Perspectives

The `PerspectiveProxy` class provides a rich interface for working with Perspectives:

```typescript
// Create a new Perspective
const perspective = await ad4m.perspective.add("My Knowledge Graph");

// Add a Link
await perspective.add({
    source: "QmSocial123://post789",
    predicate: "sioc://likes",
    target: "did:key:z6Mk..."
});

// Query Links
const links = await perspective.get({
    source: "QmSocial123://post789"
});
```

### SurrealDB Integration (Recommended)

Every Perspective includes a high-performance **SurrealDB query engine** that provides **10-100x faster performance** than traditional Prolog queries. SurrealDB is the recommended query method for most use cases:

```typescript
// Direct SurrealQL query - fast and powerful
const follows = await perspective.querySurrealDB(
  "SELECT * FROM link WHERE predicate = 'follows'"
);

// Graph traversal using indexed fields (in.uri = source, out.uri = target)
const aliceFollows = await perspective.querySurrealDB(
  "SELECT target FROM link WHERE in.uri = 'user://alice' AND predicate = 'follows'"
);

// Find who follows Alice (reverse traversal)
const aliceFollowers = await perspective.querySurrealDB(
  "SELECT source FROM link WHERE out.uri = 'user://alice' AND predicate = 'follows'"
);

// Aggregations and analytics
const stats = await perspective.querySurrealDB(
  "SELECT predicate, count() as total FROM link GROUP BY predicate"
);
```

**Performance Note**: Use `in.uri` (source) and `out.uri` (target) for graph traversal - they're indexed and fast. Avoid subqueries (`IN (SELECT ...)`) as they can be very slow.

**Security Note**: `querySurrealDB()` only allows read-only operations (SELECT, RETURN, etc.). Use `perspective.add()` and `perspective.remove()` to modify links.

For comprehensive examples and graph traversal patterns, see the [SurrealDB Queries Guide](/developer-guides/surreal-queries).

### Prolog Integration (Legacy)

Perspectives also include a Prolog engine for backward compatibility and advanced logic programming:

```typescript
// Basic Prolog query
const results = await perspective.queryProlog(
  'triple(Post, "sioc://likes", Agent), triple(Agent, "foaf://knows", "did:key:z6Mk...")'
);
// Finds posts liked by agents who know a specific person

// Real-time query subscription
const subscription = await perspective.subscribeInfer(
  'triple(Post, "sioc://status", "active"), triple(Post, "sioc://author", Author)'
);

// Set up callback for updates
subscription.onResult(results => {
    console.log("Active posts and their authors:", results);
});

// Important: Clean up subscription when done
subscription.dispose();
```

Query subscriptions provide real-time updates but require proper cleanup:

1. **Initialization**: When you create a subscription, it waits for the first result before becoming active
2. **Keepalive**: The subscription stays active through periodic keepalive signals
3. **Updates**: Receive real-time updates through your callback as the data changes
4. **Cleanup**: Call `dispose()` when done to:
   - Stop keepalive signals
   - Unsubscribe from updates
   - Notify the backend to clean up resources
   - Prevent memory leaks

Always remember to call `dispose()` when you're done with a subscription.

**Recommendation**: Use SurrealDB for most queries (faster), and reserve Prolog for complex logic programming or custom SDNA rules.

### Advanced Data Modeling

AD4M provides a sophisticated data modeling system built on top of the Prolog integration. This allows you to:
- Define TypeScript classes that map to semantic structures
- Use decorators to specify relationships
- Query with type safety and IDE support

For details on this powerful feature, see our guide on [Model Classes](/developer-guides/model-classes).

## Basic Usage Examples

Creating a Perspective:

```ts
const myNotes = ad4m.perspective.add("My private notes");
```

The returning object will be an instance of [PerspectiveProxy](/jsdoc/classes/PerspectiveProxy/)
– which essentially will work as your database instance.

Adding a Link:

```ts
const link = {
  subject: "did:key:zQ3shv5VUAbtY5P1jGsPzy7L27FTxeDv2hnhVp9QT3ALNCnQ2",
  predicate: "sioc://likes",
  target: "literal://ad4m",
};

myNotes.add(link);
```

Query Links:

```js
const allLinks = await myNotes.get(
  new LinkQuery({ predicate: "sioc://likes" })
);
```

What you get back will be an array of [LinkExpressions](/jsdoc/classes/LinkExpression/):

```json
[
  {
    "author": "did:key:zQ3shv5VUAbtY5P1jGsPzy7L27FTxeDv2hnhVp9QT3ALNCnQ2",
    "timestamp": "2023-06-21T14:47:48.935Z",
    "data": {
      "subject": "did:key:zQ3shv5VUAbtY5P1jGsPzy7L27FTxeDv2hnhVp9QT3ALNCnQ2",
      "predicate": "sioc://likes",
      "target": "literal://ad4m"
    },
    "proof": {
      "key": "#zQ3shNWd4bg67ktTVg9EMnnrsRjhkH6cRNCjRRxfTaTqBniAf",
      "signature": "xxxx"
    }
  }
]
```

Even though this Perspective is not shared (yet) but just our private, local
graph database, we might want to share it as [Neighbourhood](/neighbourhoods).
